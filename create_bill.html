{% extends "base.html" %}
{% block content %}

<div class="container mt-4">
  <div class="card shadow-lg border-0 rounded-4 p-4">
    <h3 class="text-center text-primary fw-bold mb-4">ðŸ§¾ Create New Bill</h3>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Billing Form -->
    <form method="POST" id="billingForm" novalidate>
      <!-- Patient Selection -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Select Patient</label>
        <select name="patient_id" class="form-select" required>
          <option value="">-- Select Patient --</option>
          {% for p in patients %}
            <option value="{{ p.patient_id }}">{{ p.name }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Doctor Charge -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Doctor Charge (â‚¹)</label>
        <input name="doctor_charge" id="doctorCharge" type="number" step="0.01" min="0"
               class="form-control" placeholder="Enter doctor fee" required>
      </div>

      <!-- Room Charge -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Room Charge (â‚¹)</label>
        <input name="room_charge" id="roomCharge" type="number" step="0.01" min="0"
               class="form-control" placeholder="Enter room charge" required>
      </div>

      <!-- Medicine Charge -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Medicine Charge (â‚¹)</label>
        <input name="medicine_charge" id="medicineCharge" type="number" step="0.01" min="0"
               class="form-control" placeholder="Enter total medicine charge" required>
      </div>

      <!-- Auto Total -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Total Bill (â‚¹)</label>
        <input type="text" id="totalBill" class="form-control bg-light fw-bold text-center"
               readonly value="0.00">
      </div>

      <!-- Payment Status -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Payment Status</label>
        <select name="payment_status" class="form-select" required>
          <option value="Unpaid">Unpaid</option>
          <option value="Paid">Paid</option>
        </select>
      </div>

      <!-- Buttons -->
      <div class="text-center mt-4">
        <button type="submit" class="btn btn-success px-5 fw-bold shadow-sm">ðŸ’¾ Save Bill</button>
        <a href="{{ url_for('billing') }}" class="btn btn-secondary ms-2">Cancel</a>
      </div>
    </form>
  </div>
</div>

<!-- Auto-calculate total using JS -->
<script>
function updateTotal() {
  const d = parseFloat(document.getElementById('doctorCharge').value) || 0;
  const r = parseFloat(document.getElementById('roomCharge').value) || 0;
  const m = parseFloat(document.getElementById('medicineCharge').value) || 0;
  document.getElementById('totalBill').value = (d + r + m).toFixed(2);
}
['doctorCharge', 'roomCharge', 'medicineCharge'].forEach(id => {
  document.getElementById(id).addEventListener('input', updateTotal);
});
</script>

{% endblock %}

